# Codex Continuum v100 — Continuum Σ (Sigma)
# Policy-as-Code Definition
# License: MIT + EUCLEA transparency clause

version: "1.0"
name: "Continuum Sigma Policy"
description: "Zero-trust policy for Codex Continuum v100 deployments"

rules:
  # Deployment security rules
  - id: "no-privileged-containers"
    category: "security"
    severity: "critical"
    condition: "deploy.privileged == false"
    message: "Privileged containers are not allowed"
    remediation: "Remove privileged flag from container configuration"
    
  - id: "require-resource-limits"
    category: "reliability"
    severity: "high"
    condition: "deploy.resources.limits != null"
    message: "All deployments must specify resource limits"
    remediation: "Add CPU and memory limits to deployment spec"
    
  - id: "require-signed-images"
    category: "security"
    severity: "critical"
    condition: "artifact.signature != null && artifact.signature_valid == true"
    message: "All container images must be cryptographically signed"
    remediation: "Sign images with approved key before deployment"
    
  # Attestation rules
  - id: "require-sbom-before-attest"
    category: "compliance"
    severity: "high"
    condition: "attestation.sbom_present == true"
    message: "SBOM must be generated before attestation"
    remediation: "Run SBOM generation script before attestation"
    
  - id: "require-provenance"
    category: "compliance"
    severity: "high"
    condition: "artifact.provenance != null"
    message: "Build provenance is required for all artifacts"
    remediation: "Generate provenance metadata during build"
    
  - id: "vulnerability-gate-threshold"
    category: "security"
    severity: "high"
    condition: "scan.critical_count == 0 && scan.high_count < 5"
    message: "Critical vulnerabilities must be fixed, high vulnerabilities limited to 5"
    remediation: "Fix critical vulnerabilities and reduce high severity count"

  # Runtime rules
  - id: "immutable-config"
    category: "integrity"
    severity: "medium"
    condition: "runtime.config_hash == deploy.config_hash"
    message: "Runtime configuration must match deployment configuration"
    remediation: "Ensure configuration is not modified after deployment"
    
  - id: "audit-all-actions"
    category: "compliance"
    severity: "high"
    condition: "audit.enabled == true"
    message: "All actions must be audited"
    remediation: "Enable audit logging for all operations"

# Runner modes (zero-trust)
runner_modes:
  local:
    trust_level: "low"
    isolation: "process"
    network_access: "restricted"
    
  sandbox:
    trust_level: "medium"
    isolation: "container"
    network_access: "none"
    
  http:
    trust_level: "high"
    isolation: "remote"
    network_access: "controlled"
    tls_required: true

# Feature gates
gates:
  - name: "experimental_features"
    enabled: false
    description: "Enable experimental v100 features"
    
  - name: "advanced_diffing"
    enabled: true
    description: "Semantic diff analysis for deployments"
    
  - name: "multi_target_rollout"
    enabled: true
    description: "Support for multi-environment rollouts"
    
  - name: "hermetic_builds"
    enabled: true
    description: "Fully isolated, reproducible builds"
