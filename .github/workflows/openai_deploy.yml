name: openai-deploy
on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install API requirements
        run: |
          if [ -f codex-v106/services/api/requirements.txt ]; then pip install -r codex-v106/services/api/requirements.txt; fi
      - name: Run tests (if present)
        run: |
          if [ -f pytest.ini ] || [ -d tests ]; then pytest -q || true; fi
      - name: Deploy to OpenAI Project (optional)
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_PROJECT_ID: ${{ secrets.OPENAI_PROJECT_ID }}
        run: |
          chmod +x tools/openai_deploy.sh || true
          ./tools/openai_deploy.sh
